= Simply SQL Book Questions
:page-subtitle: Databases and SQL
:page-tags: database sql exercise book
:toc: left
:sectlinks:
:icons: font
:source-highlighter: highlight.js

== Intro

Some practice questions based on the book Simply SQL.

== The WHERE Clause (chapter 4)

=== Q1

Application: Teams and Games.

[role="qanda"]
====

Select the the fields `id` and `name` of the team with id equal to 9.

.show answer
[%collapsible]
=====

[source,sql]
----
SELECT
  id
, name
FROM
  teams
WHERE
  id = 9;
----

.Result
[source,text]
----
 id |   name
----+-----------
  9 | Riff Raff
(1 row)
----
=====
====

=== Q2

Application: Teams and Games.

[role="qanda"]
====

Select the `id` and `name` fields of the team with IDs not equal to 9.

.show answer
[%collapsible]
=====

[source,sql]
----
SELECT
  id
, name
FROM
  teams
WHERE
  id <> 9;
----

.Result
[source,text]
----
 id |  name
----+---------
 37 | Havoc
 63 | Brewers
(2 rows)
----
=====
====

=== Q3

Application: Shopping Cart.

[role="qanda"]
====
Select items with price not equal to 9.37.

.show answer
[%collapsible]
=====
Equal to 9.37:

[source,sql]
----
SELECT
  id
, name
, type
, price
FROM
  items
WHERE
  price <> 9.37;
----

.Result
[source,text]
----
  id  |      name       |  type   | price
------+-----------------+---------+-------
 5022 | gadget          | doodads | 19.37
 5023 | dingus          | gizmos  | 29.37
 5041 | gewgaw          | widgets |  5.00
 5042 | knickknack      | doodads | 10.00
 5043 | whatnot         | gizmos  | 15.00
 5061 | bric-a-brac     | widgets |  2.00
 5062 | folderol        | doodads |  4.00
 5063 | jigger          | gizmos  |  6.00
 5901 | doohickey       | widgets | 12.00
 5931 | contraption     | widgets | 49.95
 5932 | whatchamacallit | doodads | 59.95
 5911 | thingamajig     | widgets | 22.22
 5912 | thingamabob     | doodads | 22.22
 5913 | thingum         | gizmos  | 22.22
 5937 | whatsis         | gizmos  | 93.70
(15 rows)
----
=====
====

=== Q4

Application: Shopping Cart.

[role="qanda"]
====
Select the fields `name` and `type` for items whose name include the string “thing”.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  name
, type
FROM
  items
WHERE
  name LIKE 'thing%';
----

.Result
[source,text]
----
    name     |  type
-------------+---------
 thingie     | widgets
 thingamajig | widgets
 thingamabob | doodads
 thingum     | gizmos
(4 rows)
----
=====
====

=== Q5

Application: Shopping Cart.

[role="qanda"]
====
Select the fields `name` and `type` for items whose name does not include the string “thing”.

[source,sql]
----
SELECT
  name
, type
FROM
  items
WHERE
  name NOT LIKE 'thing%';
----

.show answer
[%collapsible]
=====

.Result
[source,text]
----
      name       |  type
-----------------+---------
 gadget          | doodads
 dingus          | gizmos
 gewgaw          | widgets
 knickknack      | doodads
 whatnot         | gizmos
 bric-a-brac     | widgets
 folderol        | doodads
 jigger          | gizmos
 doohickey       | widgets
 gimmick         | doodads
 dingbat         | gizmos
 contraption     | widgets
 whatchamacallit | doodads
 whatsis         | gizmos
(14 rows)
----
=====
====

=== Q6

Application: Shopping Cart.

[role="qanda"]
====
Select the fields `name` and `price` for items with price ranging from 5.00 to 10.00, inclusive.
Do it using the `BETWEEN` operator and then using comparison operators.

.show answer
[%collapsible]
=====
Using between:

[source,sql]
----
SELECT
  name
, price
FROM
  items
WHERE
  price BETWEEN 4.00 AND 10.00;
----

.Result
[source,text]
----
    name    | price
------------+-------
 folderol   |  4.00
 gewgaw     |  5.00
 jigger     |  6.00
 thingie    |  9.37
 gimmick    |  9.37
 dingbat    |  9.37
 knickknack | 10.00
 (7 rows)
----
Using comparison operators:

[source,sql]
----
SELECT
  name
, price
FROM
  items
WHERE
  4.00 <= price AND price <= 10.00
ORDER BY price ASC;
----

.Result
[source,text]
----
    name    | price
------------+-------
    name    | price
------------+-------
 folderol   |  4.00
 gewgaw     |  5.00
 jigger     |  6.00
 thingie    |  9.37
 gimmick    |  9.37
 dingbat    |  9.37
 knickknack | 10.00
(7 rows)
----

[NOTE]
======
The comparison could be like this too:

[source]
----
price >= 4.00 AND price <= 10.00
----
======
=====
====

=== Q7

Application: Shopping Cart.

[role="qanda"]
====
Select the fields `id`, `name` and `billaddr` for customers whose name is either “A. Jones” or “B. Smith”.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  id
, name
, billaddr
FROM
  customers
WHERE
     name = 'A. Jones'
  OR name = 'B. Smith';
----

.Result
[source,text]
----
 id  |   name   |          billaddr
-----+----------+----------------------------
 710 | A. Jones | 123 Sesame St., Eureka, KS
 730 | B. Smith | 456 Sesame St., Eureka, KS
----
=====
====

=== Q8a

Application: Shopping Cart.

[role="qanda"]
====
Select the user name, cart id, and items id on that cart where the user is either “A. Smith” or “B. Jones” and the name of the items they bought is “thingum”.

You'll need to join four tables for this.
Careful with the precedence of `AND` over `OR`.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  customers.name AS customer
, carts.id       AS cart
, items.name     AS item
FROM
  customers
INNER JOIN carts
  ON carts.customer_id = customers.id
INNER JOIN cartitems
  ON cartitems.cart_id = carts.id
INNER JOIN items
  ON items.id = cartitems.item_id
WHERE
  (
       customers.name = 'A. Jones'
    OR customers.name = 'B. Smith'
  )
    AND items.name = 'thingum';
----

.Result
[source,text]
----
 customer | cart |  item
----------+------+---------
 A. Jones | 2131 | thingum
(1 row)
----

[NOTE]
======
Observe the use of parenthesis around the `OR` condition to give it precedence over `AND`.
======
=====
====

=== Q8b

Application: Shopping Cart.

[role="qanda"]
====
Repeat the same query as the previous question but now using `IN` the place of the `OR` condition.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  customers.name  AS customer
, carts.id        AS cart
, items.name      AS item
FROM
  customers
INNER JOIN carts
  ON carts.customer_id = carts.id
INNER JOIN cartitems
  ON cartitems.cart_id = carts.id
INNER JOIN items
  ON items.id = cartitems.item_id
WHERE
  customers.name IN ('A. Jones', 'B. Smith')
    AND items.name = 'thingum';
----

.Result
[source,text]
----
 customer | cart |  item
----------+------+---------
 A. Jones | 2131 | thingum
(1 row)
----
=====
====

=== Q9 IN + Subquery

Application: Shopping Cart.

[role="qanda"]
====
Using a subquery to provide values to the `IN` condition, select all items ever purchased by the customer with id 750.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  id
, name
FROM
  items
WHERE
  id IN (
    SELECT
      cartitems.item_id
    FROM
      cartitems
    INNER JOIN carts
      ON carts.id = cartitems.cart_id
    WHERE
      carts.customer_id = 750
  )
ORDER BY name ASC;
----

.Result
[source,text]
----
  id  |    name
------+-------------
 5912 | thingamabob
 5913 | thingum
 5937 | whatsis
(3 rows)
----

The idea is to find the IDs of items purchased by the customer with ID 750.
That is done in the subquery.
The list of IDs is simply provided by the `IN` condition in the main query.

First, find carts whose `customer_id` is 750.
Then, get the item IDs on those carts.
Those IDs are fed to the `IN` condition in the main query.
=====
====

=== Q10a Recent Entries by Category

Application: Content Management System.

[role="qanda"]
====
Using a correlated subquery, select the latest (most recent) entry from each category based on the `created` field.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  title
, category
, created
FROM
  entries AS t
WHERE
  created = (
    SELECT
      MAX(created) AS created
    FROM
      entries
    WHERE
      category = t.category
  );
----

.Result
[source,text]
----
            title            | category |       created
-----------------------------+----------+---------------------
 What If I Get Sick and Die? | angst    | 2008-12-30 00:00:00
 Be Nice to Everybody        | advice   | 2009-03-02 00:00:00
 Hello Statue                | humor    | 2009-03-17 00:00:00
 The Size of Our Galaxy      | science  | 2009-04-03 00:00:00
(4 rows)
----

The (correlated) subquery finds the max created date for each category based on `t.category`.
The main query provides categories for the subquery to match on.
=====
====

=== Q10b Recent Entries by Category

Application: Content Management System.

[role="qanda"]
====
Redo the previous exercise using a join and a subquery as a derived table.

.show answer
[%collapsible]
=====
[source,sql]
----
SELECT
  t.title
, t.category
, t.created
FROM
  entries AS t
INNER JOIN (
  SELECT
    category
  , MAX(created) AS maxdate
  FROM
    entries
  GROUP BY
    category
) AS m
  ON
    m.category = t.category
      AND m.maxdate = t.created;
----

.Result
[source,text]
----
            title            | category |       created
-----------------------------+----------+---------------------
 What If I Get Sick and Die? | angst    | 2008-12-30 00:00:00
 Be Nice to Everybody        | advice   | 2009-03-02 00:00:00
 Hello Statue                | humor    | 2009-03-17 00:00:00
 The Size of Our Galaxy      | science  | 2009-04-03 00:00:00
(4 rows)
----

Note how the join is followed by the `ON` and then two equality comparisons with `t` and `m`.
The subquery is treated (and works) as a table in this case.
=====
====

=== Question TMP

Application: Shopping Cart.

[role="qanda"]
====
Using `EXISTS` and a correlated subquery, display all customer names that have a cart.

.show answer
[%collapsible]
=====

[source,sql]
----
SELECT
  customers.name
FROM
  customers
WHERE
  EXISTS (
    SELECT
      1
    FROM
      carts
    WHERE
      carts.customer_id = customers.id
  );
----
=====
====
